<!DOCTYPE html>
<html lang="tr">
  <head>
    <base target="_top" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <?!= include('styles'); ?>
    <style>
      .button-group {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Faturalarƒ± G√∂r√ºnt√ºle</h2>
      <div class="button-group">
        <button class="btn-green" onclick="viewFaturalar('fatura')">
          Fatura G√∂r√ºnt√ºle
        </button>
        <button class="btn-red" onclick="viewFaturalar('proforma')">
          Proforma G√∂r√ºnt√ºle
        </button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Fatura No</th>
            <th>M√º≈üteri</th>
            <th>Tarih</th>
            <th>ƒ∞≈ülemler</th>
          </tr>
        </thead>
        <tbody id="faturaTableBody"></tbody>
      </table>
    </div>
    <script>
      console.log("Test");
      function viewFaturalar(type) {
        google.script.run
          .withSuccessHandler((data) => {
            const tbody = document.getElementById("faturaTableBody");
            tbody.innerHTML = "";
            if (data.length === 0) {
              tbody.innerHTML =
                "<tr><td colspan='4'>Veri bulunamadƒ±.</td></tr>";
              return;
            }
            data.forEach((item, index) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${item.faturaNo}</td>
                <td>${item.musteri}</td>
                <td>${item.tarih}</td>
                <td>
                  <button class="btn-blue" onclick="viewPDF('${item.pdfUrl}')">üîç</button>
                  <button class="btn-blue" onclick="editFatura(${index}, '${type}')">‚úèÔ∏è</button>
                </td>
              `;
              tbody.appendChild(row);
            });
          })
          .withFailureHandler((error) => {
            Swal.fire("Hata!", error.message, "error");
          })
          .getFaturaList(type);
      }

      function viewPDF(url) {
        if (url) window.open(url, "_blank");
        else Swal.fire("Hata!", "PDF URL bulunamadƒ±.", "error");
      }

      function editFatura(index, type) {
        google.script.run
          .withSuccessHandler((data) => {
            window.location.href = `${getAppUrl()}?page=${
              type === "fatura" ? "faturaKes" : "proformaKes"
            }&edit=${index}`;
          })
          .getFaturaByIndex(index, type);
      }
    </script>
  </body>
</html>
